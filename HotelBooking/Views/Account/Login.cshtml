@{
    ViewBag.Title = "Đăng nhập";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3>Đăng nhập</h3>
            </div>
            <div class="card-body">
                <form id="loginForm">
                    <div id="error-message" class="alert alert-danger" style="display:none;"></div>

                    <div class="form-group mb-3">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="email" name="Email" placeholder="Email" required />
                    </div>

                    <div class="form-group mb-3">
                        <label for="password">Mật khẩu</label>
                        <input type="password" class="form-control" id="password" name="Password" placeholder="Mật khẩu" required />
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="rememberMe" name="RememberMe" />
                            <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <button type="submit" class="btn btn-primary btn-block w-100">Đăng nhập</button>
                    </div>

                    <div class="text-center">
                        <a href="/Account/ForgotPassword">Quên mật khẩu?</a> |
                        <a href="/Account/Register">Đăng ký tài khoản mới</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $("#loginForm").submit(function (e) {
                e.preventDefault();

                var formData = {
                    Email: $("#email").val(),
                    Password: $("#password").val(),
                    RememberMe: $("#rememberMe").is(':checked')
                };

                $.ajax({
                    type: "POST",
                    url: window.location.origin + '/Account/Login',
                    data: JSON.stringify(formData),
                    contentType: "application/json; charset=utf-8",
                    success: function (response) {
                        if (response.success) {
                            window.location.href = response.redirectUrl || '/Home/Index';
                        } else {
                            $("#error-message").text(response.message).show();
                        }
                    },
                    error: function (xhr) {
                        var error = xhr.responseJSON;
                        if (error && error.message) {
                            $("#error-message").text(error.message).show();
                        } else {
                            $("#error-message").text("Đã xảy ra lỗi. Vui lòng thử lại.").show();
                        }
                    }
                });
            });
        });
    </script>
}