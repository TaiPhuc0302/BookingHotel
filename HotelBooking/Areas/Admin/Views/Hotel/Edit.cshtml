@{
    ViewBag.Title = "Chỉnh sửa Khách sạn";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <h2>Chỉnh sửa Khách sạn</h2>

    <div class="card">
        <div class="card-body">
            <form id="hotelForm">
                <input type="hidden" id="hotelId" value="@ViewBag.HotelId" />

                <div id="success-message" class="alert alert-success" style="display:none;"></div>
                <div id="error-message" class="alert alert-danger" style="display:none;"></div>

                <div class="form-group mb-3">
                    <label for="name">Tên khách sạn <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="name" required />
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="address">Địa chỉ</label>
                        <input type="text" class="form-control" id="address" />
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="city">Thành phố</label>
                        <input type="text" class="form-control" id="city" />
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="country">Quốc gia</label>
                        <input type="text" class="form-control" id="country" />
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label for="starRating">Hạng sao</label>
                    <input type="number" class="form-control" id="starRating" min="1" max="5" />
                </div>

                <div class="form-group mb-3">
                    <label for="description">Mô tả</label>
                    <textarea class="form-control" id="description" rows="5"></textarea>
                </div>

                <div class="form-group mb-3">
                    <label for="isActive">Trạng thái <span class="text-danger">*</span></label>
                    <select class="form-control" id="isActive" required>
                        <option value="true">Đang hoạt động</option>
                        <option value="false">Tạm dừng</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-warning">Cập nhật</button>
                <a href="/Admin/Hotel/Index" class="btn btn-secondary">Hủy</a>
            </form>
        </div>
    </div>
</div>

@section scripts {
    <script>
        var hotelId = parseInt($("#hotelId").val());

        $(document).ready(function () {
            loadHotelData();

            $("#hotelForm").submit(function (e) {
                e.preventDefault();
                updateHotel();
            });
        });

        function loadHotelData() {
            $.ajax({
                type: "GET",
                url: window.location.origin + '/Admin/Hotel/GetHotelById/' + hotelId,
                success: function (response) {
                    if (response.success) {
                        var hotel = response.data;
                        $("#name").val(hotel.Name);
                        $("#address").val(hotel.Address);
                        $("#city").val(hotel.City);
                        $("#country").val(hotel.Country);
                        $("#starRating").val(hotel.StarRating);
                        $("#description").val(hotel.Description);

                        $("#isActive").val(hotel.IsActive === true || hotel.IsActive === "True" ? "true" : "false");
                    }
                },
                error: function () {
                    alert("Không tải được thông tin khách sạn");
                }
            });
        }

        function updateHotel() {
            var formData = {
                Id: hotelId,
                Name: $("#name").val(),
                Address: $("#address").val(),
                City: $("#city").val(),
                Country: $("#country").val(),
                StarRating: parseInt($("#starRating").val()),
                Description: $("#description").val(),
                IsActive: $("#isActive").val() === "true"
            };

            // Kiểm tra bắt buộc
            if (!formData.Name) {
                $("#error-message").text("Vui lòng nhập tên khách sạn").show();
                return;
            }

            $.ajax({
                type: "POST",
                url: window.location.origin + '/Admin/Hotel/UpdateHotel',
                data: JSON.stringify(formData),
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    if (response.success) {
                        $("#success-message").text(response.message).show();
                        $("#error-message").hide();
                        setTimeout(function () {
                            window.location.href = '/Admin/Hotel/Index';
                        }, 1500);
                    } else {
                        $("#error-message").text(response.message).show();
                        $("#success-message").hide();
                    }
                }
            });
        }
    </script>
}   